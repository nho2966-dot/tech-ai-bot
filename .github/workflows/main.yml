name: Tech AI Bot Production

on:
  schedule:
    # ÙŠØ¹Ù…Ù„ ÙƒÙ„ Ø³Ø§Ø¹Ø© (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø­Ø³Ø¨ Ø­Ø§Ø¬ØªÙƒ)
    - cron: '0 * * * *'
  workflow_dispatch: # Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    
    # Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© Ù‡Ù†Ø§: ØªØ®Ø¨Ø± GitHub Ø£Ù† ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØªØªÙ… Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¨ÙˆØª
    defaults:
      run:
        working-directory: tech-ai-bot

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' # ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªØ«Ø¨ÙŠØª ÙÙŠ Ø§Ù„Ù…Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Tech AI Bot
        env:
          # ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙÙŠ Settings > Secrets and variables > Actions
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          # Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          DRY_RUN: 0
          REPLY_ENABLED: 1
          VIDEO_ENABLED: 1
        run: python main.py

      # Ø®Ø·ÙˆØ© Ù‡Ø§Ù…Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª (state.json) ÙˆØ§Ù„Ù„ÙˆØ¬Ø²
      - name: Commit and Push Changes
        if: always() # Ø§Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Ø§Ù„ÙƒÙˆØ¯
        run: |
          git config --global user.name "Tech-AI-Bot[bot]"
          git config --global user.email "bot@tech-ai.com"
          git add state.json logs/ audit_log.jsonl
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ”„ Update bot state and logs [skip ci]" && git push)
