name: build-and-run

on:
  schedule:
    # Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ: 4 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹ (ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª) Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¥ØºØ±Ø§Ù‚
    - cron: '0 */6 * * *' 
  workflow_dispatch: # Ù…ØªØ§Ø­ Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    
    # ØªØµØ±ÙŠØ­ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¶Ø±ÙˆØ±ÙŠ Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Ø³Ø­Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ§Ù…Ù„ Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ Push

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install tweepy feedparser google-genai python-dotenv openai

      - name: Run Tech-Elite Bot
        run: python main.py
        env:
          GEMINI_KEY: ${{ secrets.GEMINI_KEY }}
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          X_BEARER_TOKEN: ${{ secrets.X_BEARER_TOKEN }}
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}

      - name: Sync and Push Database Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØµÙ…Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†: Ø³Ø­Ø¨ Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹
          git pull origin main --rebase
          
          # Ø¥Ø¶Ø§ÙØ© ØªØ­Ø¯ÙŠØ«Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
          git add news.db
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ±Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù€ Commit Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø®Ø·Ø£
          if git diff --staged --quiet; then
            echo "No changes in database to commit."
          else
            git commit -m "ğŸ›¡ï¸ Database Auto-Update [Skip CI]"
            git push origin main
          fi
