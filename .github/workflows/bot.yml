name: Nasser Apex Bot Workflow

on:
  schedule:
    # Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ù…Ø­Ø³ÙˆØ¨Ø© Ø¨ØªÙˆÙ‚ÙŠØª UTC (Ù†Ø·Ø±Ø­ 4 Ø³Ø§Ø¹Ø§Øª Ù…Ù† ØªÙˆÙ‚ÙŠØª Ù…Ø³Ù‚Ø· ÙˆØ§Ù„Ø±ÙŠØ§Ø¶)
    - cron: '0 1 * * *'  # 05:00 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ - Ø£Ø®Ø¨Ø§Ø± Ø­ØµØ±ÙŠØ©
    - cron: '0 9 * * *'  # 01:00 Ø¸Ù‡Ø±Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ - Ø£Ø¯ÙˆØ§Øª ØªÙ‚Ù†ÙŠØ©
    - cron: '0 14 * * *' # 06:00 Ù…Ø³Ø§Ø¡Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ - Ù…Ø³Ø§Ø¨Ù‚Ø§Øª
    - cron: '0 18 * * *' # 10:00 Ù…Ø³Ø§Ø¡Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ - ØªÙØ§Ø¹Ù„ ÙˆØ±Ø¯ÙˆØ¯
  workflow_dispatch: # Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¨ÙˆØª Ø¨ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Ù„Ø³Ø­Ø¨ ÙƒØ§Ù…Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ø¶Ù…Ø§Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ù€ Rebase

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; else pip install google-genai openai tweepy requests python-dotenv; fi

      - name: Run Nasser Apex Bot
        env:
          # Ø§Ù„Ø¹Ù‚ÙˆÙ„ Ø§Ù„Ù…ØªÙ†Ø§ÙˆØ¨Ø© (ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙÙŠ Secrets)
          GEMINI_KEY: ${{ secrets.GEMINI_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          XAI_API_KEY: ${{ secrets.XAI_API_KEY }}
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          
          # Ù…ÙØ§ØªÙŠØ­ Ù…Ù†ØµØ© X
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
          X_BEARER_TOKEN: ${{ secrets.X_BEARER_TOKEN }}
        run: python main.py

      - name: Sync Database Changes
        run: |
          git config --local user.email "bot@nasser-ai.com"
          git config --local user.name "NasserApexBot"
          
          mkdir -p data
          git add data/*.db || echo "No database found"
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ±Ø§Øª
          if ! git diff --cached --quiet; then
            # Ø¬Ù„Ø¨ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ (Rebase)
            git pull origin main --rebase
            git commit -m "ğŸ›¡ï¸ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„Ø§Øª Ø£ÙŠØ¨ÙƒØ³ Ø§Ù„ØªÙ‚Ù†ÙŠØ© [skip ci]"
            git push origin main
          else
            echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­ÙØ¸Ù‡Ø§."
          fi
