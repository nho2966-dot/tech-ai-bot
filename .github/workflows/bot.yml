name: Nasser Apex Bot Workflow

on:
  schedule:
    # Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ù…Ø­Ø³ÙˆØ¨Ø© Ø¨ØªÙˆÙ‚ÙŠØª UTC (Ù†Ø·Ø±Ø­ 4 Ø³Ø§Ø¹Ø§Øª Ù…Ù† ØªÙˆÙ‚ÙŠØª Ù…Ø³Ù‚Ø·/Ø§Ù„Ø±ÙŠØ§Ø¶)
    - cron: '0 1 * * *'  # 05:00 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ (ÙˆÙ‚Øª Ø§Ù„Ø³Ø­ÙˆØ± ÙˆØ§Ù„ÙØ¬Ø±) - Ø£Ø®Ø¨Ø§Ø± Ø­ØµØ±ÙŠØ©
    - cron: '0 9 * * *'  # 01:00 Ø¸Ù‡Ø±Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ (ÙˆÙ‚Øª Ø§Ù„Ø±Ø§Ø­Ø©) - Ø£Ø¯ÙˆØ§Øª ØªÙ‚Ù†ÙŠØ©
    - cron: '0 14 * * *' # 06:00 Ù…Ø³Ø§Ø¡Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ (ÙˆÙ‚Øª Ø§Ù„Ø°Ø±ÙˆØ© Ù‚Ø¨Ù„ Ø§Ù„ÙØ·ÙˆØ±) - Ù…Ø³Ø§Ø¨Ù‚Ø§Øª
    - cron: '0 18 * * *' # 10:00 Ù…Ø³Ø§Ø¡Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ù„ÙŠØ¬ (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­) - ØªÙØ§Ø¹Ù„ ÙˆØ±Ø¯ÙˆØ¯
  workflow_dispatch: # Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Ø¶Ø±ÙˆØ±ÙŠ Ø¬Ø¯Ø§Ù‹ Ø¹Ø´Ø§Ù† Ø§Ù„Ø¨ÙˆØª ÙŠÙ‚Ø¯Ø± ÙŠØ­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ Ø§Ù„Ù€ Database

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Nasser Apex Bot
        env:
          # ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙÙŠ GitHub Secrets
          GEMINI_KEY: ${{ secrets.GEMINI_KEY }}
          XAI_API_KEY: ${{ secrets.XAI_API_KEY }}
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
          X_BEARER_TOKEN: ${{ secrets.X_BEARER_TOKEN }}
        run: python main.py

      - name: Sync Database Changes
        run: |
          git config --local user.email "bot@nasser-ai.com"
          git config --local user.name "NasserApexBot"
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ data Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
          mkdir -p data
          
          # Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù„Ù Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡
          git add data/*.db || echo "No database found"
          
          # ØªÙ†ÙÙŠØ° Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙ‚Ø· Ø¥Ø°Ø§ ÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ›¡ï¸ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„Ø§Øª Ø£ÙŠØ¨ÙƒØ³ Ø§Ù„ØªÙ‚Ù†ÙŠØ© [skip ci]"
            git push
          else
            echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­ÙØ¸Ù‡Ø§."
          fi
