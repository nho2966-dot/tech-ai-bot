import os
import requests
import tweepy
import random
from google import genai
import logging
import hashlib
import time
import re

# 1. ุฅุนุฏุงุฏ ูุธุงู ุงูุชุณุฌูู
if not os.path.exists("logs"):
    os.makedirs("logs")

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler("logs/bot.log", encoding='utf-8'),
        logging.StreamHandler()
    ]
)

def clean_arabic_text(text):
    """
    ุชูุธูู ุงููุต ูู ุฃู ุฑููุฒ ุบุฑูุจุฉ ุฃู ูุบุงุช ุบูุฑ ูุฑุบูุจ ูููุง (ูุซู ุงูุฑููุฒ ุงููุงุจุงููุฉ) 
    ูุถูุงู ุธููุฑ ุงูุชุบุฑูุฏุฉ ุจุดูู ุงุญุชุฑุงูู.
    """
    # ุงูุณูุงุญ ููุท ุจุงูุญุฑูู ุงูุนุฑุจูุฉุ ุงูุฃุฑูุงูุ ุงูุฅูููุฌู ุงูุฃุณุงุณูุ ูุนูุงูุงุช ุงูุชุฑููู
    # ูุฐุง ูููุน ุธููุฑ ุฑููุฒ ูุซู 'ใ' ุงูุชู ุธูุฑุช ุณุงุจูุงู.
    cleaned = re.sub(r'[^\u0600-\u06FF\s0-9\.\?\!\,\:\-\#\(\)๐ฆ๐ค๐๐กโจ๐ง๐]', '', text)
    # ุฅุฒุงูุฉ ุงููุฑุงุบุงุช ุงูุฒุงุฆุฏุฉ
    return " ".join(cleaned.split())

def generate_content_from_gemini():
    """ุชูููุฏ ูุญุชูู ุชููู ูุตูุญ ูุฎุงูู ูู ุงูุฃุฎุทุงุก ุงููุบููุฉ."""
    try:
        api_key = os.getenv("GEMINI_KEY")
        if not api_key:
            return None, None
        
        client = genai.Client(api_key=api_key)

        # ุฑูุงุฆุฒ ุงููุญุชูู ุงููุทูุฑ ูุนุงู 2026
        topics = [
            "ุฃุญุฏุซ ููุฒุฉ ูู ุงูุญูุณุจุฉ ุงููููุฉ ูุชุฃุซูุฑูุง ุนูู ุชุดููุฑ ุงูุจูุงูุงุช.",
            "ููู ุณูุบูุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููููู ุงูุชุนููู ุงูุดุฎุตู ูู ุงููุณุชูุจู ุงููุฑูุจ.",
            "ุงูุชุทูุฑุงุช ุงููุฐููุฉ ูู ุงูุฑูุจูุชุงุช ุงูุทุจูุฉ ูุฏูุฑูุง ูู ุงูุนูููุงุช ุงูุฌุฑุงุญูุฉ ุงููุนูุฏุฉ.",
            "ูุณุชูุจู ุงููุฏู ุงูุฐููุฉ ูููููุฉ ุฅุฏุงุฑุฉ ุงูุทุงูุฉ ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู."
        ]
        
        selected_topic = random.choice(topics)
        
        prompt = f"""
        ุฃูุช ูุญุฑุฑ ุชููู ูุนุงูู ูุบูู ุฎุจูุฑ ูู ุงููุบุฉ ุงูุนุฑุจูุฉ.
        ุงูุชุจ ุชุบุฑูุฏุฉ ุงุญุชุฑุงููุฉ ุฌุฏุงู ุนู: {selected_topic}
        
        ุงููุนุงููุฑ ุงููุทููุจุฉ ูุถูุงู ุงูุฌูุฏุฉ:
        1. ุงููุบุฉ: ุงุณุชุฎุฏู ูุบุฉ ุนุฑุจูุฉ ูุตุญู 'ุณูููุฉ ุชูุงูุงู' (ูุญูุงู ูุตุฑูุงู ูุฅููุงุกู).
        2. ุชุฌูุจ ุงููุตุทูุญุงุช ุงููุชุฑุฌูุฉ ุฎุทุฃ (ูุซู ุงููุชููููู) ูุงุณุชุฎุฏู (ุงูุชููููู ุฃู ุงูุฎุจุฑุงุก).
        3. ุงูุชูุณูู: ุงุจุฏุฃ ุจุฌููุฉ ูุดููุฉุ ุซู ุญูููุฉ ุชูููุฉุ ูุงุฎุชู ุจุณุคุงู ูุญูุฒ ุงููุชุงุจุนูู ุนูู ุงูุฑุฏ.
        4. ููููุน ุงุณุชุฎุฏุงู ุฃู ุฑููุฒ ุบูุฑ ุนุฑุจูุฉ ุฃู ูุบุงุช ุฃุฌูุจูุฉ ุฏุงุฎู ุงููุต.
        5. ุงุณุชุฎุฏู ุฅูููุฌู ุชููู ูุงุญุฏ ุฃู ุงุซููู ููุท.
        """
